	<!DOCTYPE html>
<html>
<head>
	<title>fcoo.dk</title>
	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="application-name" content="fcoo.dk">
    <meta name="apple-mobile-web-app-title" content="fcoo.dk">
    <meta name="msapplication-TileImage" content="/apple-touch-icon.png">
    <meta name="msapplication-TileColor" content="#1C4B88">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="shortcut icon" href="/apple-touch-icon.png">

    <link rel="stylesheet" type="text/css" href="css/index.min.css" />
		<link rel="stylesheet" href="leaflet.css" />
</head>
<body>
	<div class="container">
		<a class="show-for-lang-da" href="//fcoo.dk/" border="0"><img class="logo" width="270" height="90" src="//media.fcoo.dk/logos/FCOO_logo_270x90.png" alt="Forsvarets Center for Operativ Oceanografi"></a>
		<a class="show-for-lang-en" href="//fcoo.dk/?lang=eng" border="0"><img class="logo" width="270" height="90" src="//media.fcoo.dk/logos/FCOO_logo_270x90.png" alt="Defence Centre for Operational Oceanography"></a>

		<h1 class="show-for-lang-da">Sejladsudsigt</h1>
		<h1 class="show-for-lang-en">Marine Forecast</h1>

		<select id="select-area" onchange="onChange(this)"></select>	

		<div id="map"></div>		
	</div>

	<script src="leaflet.js"></script>
	<script type="text/javascript">
		//Get lang from url and set class-name
		var isEn = false,
				regex = new RegExp("[\\?&]" + 'lang' + "=([^&#]*)"),
				lang = regex.exec(location.search);
		lang = lang === null ? "" : decodeURIComponent(lang[1].replace(/\+/g, " ")).toUpperCase();
		isEn = ((lang == 'EN') || (lang == 'ENG'));

		//Set lang-class and title
		document.body.className = isEn ? 'lang-en' : 'lang-da';
		document.title = 'fcoo.dk - ' + (isEn ? 'Marine Forecast' : 'Sejladsudsigt');

		//List of areas
		var areas = [
			{	da: 'Danmark',				en:'Denmark',				href:'denmark/',				bounds: [[61.0157,  -3.3618], [ 52.8558,  24.5214]]	},
			{	da: 'Grønland',				en:'Greenland',			href:'greenland/',			bounds: [[76.7605, -61.2158], [ 58.6198, -16.2158]]	},
			{	da: 'Færøerne',				en:'Faroe Islands',	href:'faroe_islands/',	bounds: [[63.8019, -13.9745], [ 59.7563,  -1.2744]]	},
			{	da: 'Middelhavet',		en:'Mediterranean',	href:'mediterranean/',	bounds: [[46.3469, -11.8652], [ 26.6671,  39.0674]]	},
			{	da: 'Indiske Ocean',	en:'Indian Ocean',	href:'indian_ocean/',		bounds: [[29.8406,	31.6406], [-19.8907,  69.9609]]	},
		];

		//Set da- or en-name
		for (i=0; i<areas.length; i++ )
			areas[i].name = isEn ? areas[i].en : areas[i].da;
		
		//Add options to <select>
		var select = document.getElementById('select-area'),
				addOption = function(select, text, value, selected){ 
					var option = document.createElement('option');
					if (value !== null)
						option.value = value;				  
					option.innerHTML = text;
					if (selected)
						option.setAttribute("selected", "selected");
					select.appendChild(option);
				};

		function onChange( select ) {
			var option	= select.options[select.selectedIndex];
			if (option.value)
				selectAreaByIndex( option.value );  
		};
		
		//Add default option
		addOption(select, isEn ? '** Select Area **' : '** Vælg Område **', null, true);

		for (i=0; i<areas.length; i++ )
			addOption(select, areas[i].name, i);
		
		
		//Create Leaflet map
		var minZoom = 1, 
				defaultZoom = 2,
				maxZoom	= 4,
				style				= {color: 'cornflowerblue', weight: 1,		opacity: 0.5, fillOpacity:0.4},
				hoverStyle	= {color: 'blue',						weight: 1.5,	opacity: 0.9, fillOpacity:0.4},
				clickStyle	= {color: 'red',						weight: 1.5,	opacity: 0.9, fillOpacity:0.4},

				map = L.map('map').setView([45.3367, -1.7578], defaultZoom);

//For debug		map.on('click', function(e){ console.log('mouse:',e.latlng, 'map-center', map.getCenter(), 'map-zoom', map.getZoom()); });

		L.tileLayer('https://tiles{s}.fcoo.dk/tiles/tiles_bckgrnd_512_mercator_201508030000/{z}/{x}/{y}.png', {minZoom: minZoom, maxZoom: maxZoom, subdomains:['01','02','03'], tileSize:512,  continuousWorld: false	}).addTo(map);
//		L.tileLayer('https://tiles{s}.fcoo.dk/tiles/tiles_top_512_mercator_201508030000/{z}/{x}/{y}.png', {maxZoom: 18, minZoom: minZoom, maxZoom: maxZoom, subdomains:['01','02','03'], tileSize:512,  continuousWorld: false	}).addTo(map);

		for (i=0; i<areas.length; i++ ){
			var area = areas[i],
					rect = L.rectangle(area.bounds, style).addTo(map);		
			rect.options._area_index = i;
			
			area.rect = rect;

			rect.on('click',			function( event ){ selectAreaByIndex( event.target.options._area_index );	});
			rect.on('mousedown',	function( event ){ event.target.setStyle( clickStyle	);									});

			rect.on('mouseover',	function( event ){ 
				var rect = event.target;
				rect.setStyle( hoverStyle	);	
				select.selectedIndex = rect.options._area_index + 1;
			});

			rect.on('mouseout',		function( event ){ 
				event.target.setStyle( style			);	
				select.selectedIndex = 0;
			});

			rect._container.setAttribute('title', area.name);
		}
		
		//Select the area	
		function selectAreaByIndex( index ) { 
			var area = areas[index];
			area.rect.setStyle( clickStyle ); 
			window.location.href = area.href + (isEn ? '?lang=en' : '');
		}

	</script>		
		
		
		<!-- Piwik -->
    <script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(['disableCookies']);
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.fcoo.dk/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <noscript><p><img src="//analytics.fcoo.dk/piwik/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
    <!-- End Piwik Code -->
</body>
</html>
